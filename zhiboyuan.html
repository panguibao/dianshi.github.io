<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U to M3U8 Converter</title>

    <style>
        body {
            font-size: 1.6em;
        }

        h1 {
            font-size: 2em;
        }

        #convertPreview {
            white-space: pre-wrap; /* 允许换行 */
            font-size: 1.4em;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
        }

        #convertStatus {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        #convertButton {
            font-size: 1.2em;
            cursor: pointer;
            padding: 8px 12px;
            margin-bottom: 10px;
        }

        #downloadButton {
            font-size: 1.2em;
            cursor: pointer;
            padding: 8px 12px;
            margin-top: 10px;
            display: none; /* 初始时隐藏下载按钮 */
        }

        #progressContainer {
            margin-bottom: 10px;
        }

        #progressBarContainer {
            width: 100%;
            background-color: #eee;
            height: 20px;
            border-radius: 5px;
            overflow: hidden;
        }

        #progressBar {
            height: 100%;
            width: 0%;
            background-color: limegreen;
            transition: width 0.5s ease;
        }

        #m3uInputContainer {
            display: flex;
            flex-direction: column; /* 将容器内元素垂直排列 */
        }

        #m3uInput {
            font-size: 1.4em; /* 调整字体大小 */
            margin-bottom: 10px; /* 调整输入框和标签之间的间距 */
            transition: border 0.3s; /* 添加过渡效果 */
        }

        #m3uInput:invalid {
            border: 1px solid red;
        }

        #m3uInput:valid {
            border: 1px solid limegreen; /* 选择文件后显示绿色边框 */
        }
    </style>
</head>
<body>

    <h1>M3U 转 M3U8 转换器</h1>

    <div id="m3uInputContainer">
        <input type="file" id="m3uInput" accept=".m3u" onchange="showPreview()" required>
    </div>

    <div id="convertPreview"></div>
    <div id="convertStatus"></div>

    <div id="progressContainer">
        <div id="progressBarContainer">
            <div id="progressBar"></div>
        </div>
    </div>

    <button id="convertButton" onclick="performConversion()">转换</button>
    <button id="downloadButton" onclick="downloadM3U8()">下载 M3U8</button>

    <a id="downloadLink" style="display: none;" download="output.m3u8">下载 M3U8</a>

    <audio id="conversionCompleteSound" src="path/to/your/soundfile.mp3"></audio>

    <script>
        const m3uInput = document.getElementById('m3uInput');
        const convertPreview = document.getElementById('convertPreview');
        const convertStatus = document.getElementById('convertStatus');
        const convertButton = document.getElementById('convertButton');
        const downloadButton = document.getElementById('downloadButton');
        const downloadLink = document.getElementById('downloadLink');
        const progressBar = document.getElementById('progressBar');

        m3uInput.addEventListener('change', function () {
            showPreview();
            convertStatus.textContent = ''; // 清空状态信息
            if (m3uInput.value) {
                m3uInputContainer.style.flexDirection = 'row'; // Change to horizontal layout
                m3uInput.style.marginBottom = '0'; // Remove margin bottom
            } else {
                m3uInputContainer.style.flexDirection = 'column'; // Change back to vertical layout
                m3uInput.style.marginBottom = '10px'; // Restore margin bottom
            }
        });

        function showPreview() {
            const file = m3uInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const content = e.target.result;
                    convertPreview.textContent = content;
                };
                reader.readAsText(file);
            } else {
                convertPreview.textContent = '';
            }
        }

        function performConversion() {
            const m3uContent = convertPreview.textContent;
            if (m3uContent) {
                convertStatus.textContent = '正在转换...'; // 显示转换状态

                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    progressBar.style.width = progress + '%';

                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            convertPreview.textContent = ''; // 清空之前的显示
                            convertStatus.textContent = '转换完成'; // 显示转换完成状态
                            downloadButton.style.display = 'block'; // 显示下载按钮

                            // 播放提示音
                            const audio = document.getElementById('conversionCompleteSound');
                            audio.play();
                    
                            // 直接触发下载按钮点击事件
                            downloadButton.click();
                        }, 500);
                    }
                }, 200);
            } else {
                convertStatus.textContent = '请先选择 M3U 文件并查看预览，然后再进行转换。';
            }
        }

        function downloadM3U8() {
            const m3u8Content = convertPreview.textContent;
            if (m3u8Content) {
                // Trigger download
                const blob = new Blob([m3u8Content], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                downloadLink.href = url;

                // 直接触发下载链接点击事件
                downloadLink.click();
            }
        }
    </script>

</body>
</html>